(()=>{"use strict";function e(){var e,t,n;e=document.getElementById("dropZone"),t=document.getElementById("fileInput"),n=async e=>{try{!function(e){document.getElementById("result").innerHTML=`\n        <div class="result-card">\n            <h3>Analysis Results</h3>\n            <canvas id="resultCanvas"></canvas>\n            <div class="metrics">\n                <div class="metric">\n                    <span class="label">Max Brightness:</span>\n                    <span class="value">${e.maxBrightness.toFixed(2)}</span>\n                </div>\n                <div class="metric">\n                    <span class="label">Radius Mean:</span>\n                    <span class="value">${e.radiusMean.toFixed(2)}</span>\n                </div>\n            </div>\n        </div>\n    `;const t=document.getElementById("resultCanvas"),n=t.getContext("2d");t.width=e.frame.width,t.height=e.frame.height,n.putImageData(e.frame,0,0),n.beginPath(),n.arc(e.brightestX,e.brightestY,10,0,2*Math.PI),n.strokeStyle="#ff0000",n.lineWidth=2,n.stroke()}(await async function(e){const t=await async function(e){return new Promise(((t,n)=>{const s=document.createElement("video");s.preload="auto",s.src=URL.createObjectURL(e),s.muted=!0,s.addEventListener("loadedmetadata",(()=>t(s))),s.addEventListener("error",(e=>n(e)))}))}(e),{frame:n,maxBrightness:s,brightestX:a,brightestY:r}=await async function(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.videoWidth,t.height=e.videoHeight;let s=-1,a=null,r=0,i=0;if(await new Promise((d=>{e.addEventListener("seeked",(function c(){n.drawImage(e,0,0);const o=n.getImageData(0,0,t.width,t.height),{brightness:l,x:h,y:u}=function(e){const t=e.data;let n=-1,s=-1;for(let e=0;e<t.length;e+=4){const a=.299*t[e]+.587*t[e+1]+.114*t[e+2];a>n&&(n=a,s=e/4)}return{brightness:n,x:s%e.width,y:Math.floor(s/e.width)}}(o);l>s&&(s=l,a=o,r=h,i=u),e.currentTime<e.duration?e.currentTime+=.1:(e.removeEventListener("seeked",c),d())})),e.currentTime=0})),!a)throw new Error("No frames processed");return{frame:a,maxBrightness:s,brightestX:r,brightestY:i}}(t),i=function(e,t,n){const s=e.data;let a=0,r=0;for(let i=-10;i<=10;i++)for(let d=-10;d<=10;d++){const c=t+d,o=n+i;if(c>=0&&c<e.width&&o>=0&&o<e.height){const t=4*(o*e.width+c);a+=.299*s[t]+.587*s[t+1]+.114*s[t+2],r++}}return a/r}(n,a,r);return{frame:n,maxBrightness:s,radiusMean:i,brightestX:a,brightestY:r}}(e))}catch(e){t=e instanceof Error?e.message:"Processing failed",document.getElementById("result").innerHTML=`<div class="error">${t}</div>`}var t},e.addEventListener("click",(()=>t.click())),e.addEventListener("dragover",(t=>{t.preventDefault(),e.classList.add("dragover")})),e.addEventListener("dragleave",(()=>{e.classList.remove("dragover")})),e.addEventListener("drop",(s=>{s.preventDefault(),e.classList.remove("dragover"),s.dataTransfer?.files.length&&(t.files=s.dataTransfer.files,t.files?.[0]&&n(t.files[0]))})),t.addEventListener("change",(()=>{t.files?.[0]&&n(t.files[0])}))}document.addEventListener("DOMContentLoaded",(()=>{e()}))})();